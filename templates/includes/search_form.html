{% load mezzanine_tags i18n future %}
<div itemscope itemtype="http://schema.org/WebSite">
<meta itemprop="url" content="http://www.phodal.com/" />
<form action="{% url "search" %}" class="navbar-search pull-right input-append"  itemprop="potentialAction" itemscope itemtype="http://schema.org/SearchAction">
<meta itemprop="target" content="http://www.phodal.com/search/?q={search_term_string}"/>
<input class="search-query" id="autocomplete" placeholder="{% trans "Search" %}" type="text" name="q" value="{{ request.REQUEST.q }}"  itemprop="query-input" type="text" name="search_term_string" required/>

 <script>
$('#autocomplete').autocomplete({
    minChars: 2,
    width: 350,
    serviceUrl: '/api/blog_list/?format=json',
    paramName: 'search',
    transformResult: function(response) {
        var result = [];
        $.each(JSON.parse(response), function(index, dataItem) {
            result.push({value: dataItem.title, data: dataItem.slug});
        });

        return { suggestions: result }
    },
    onSelect: function (suggestion) {
        console.log(suggestion)
        window.location.href = "{% url "blog_post_list" %}" + suggestion.data;
    }
});
</script>

</form>
</div>